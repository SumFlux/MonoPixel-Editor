# MonoPixel Editor 用户手册

## 目录

1. [简介](#简介)
2. [安装与运行](#安装与运行)
3. [界面介绍](#界面介绍)
4. [基础操作](#基础操作)
5. [工具详解](#工具详解)
6. [图层管理](#图层管理)
7. [文本工具](#文本工具)
8. [选择工具](#选择工具)
9. [导出功能](#导出功能)
10. [项目管理](#项目管理)
11. [快捷键参考](#快捷键参考)
12. [常见问题](#常见问题)

---

## 简介

MonoPixel Editor 是一个专为嵌入式 OLED/LCD 开发设计的单色像素画编辑器。它支持 1-bit 颜色深度（黑/白），提供完整的绘图工具集、多图层管理、智能文本渲染和多种取模格式导出。

### 主要特性

- ✅ **完整的绘图工具**：画笔、橡皮擦、直线、矩形、圆形、填充、选择
- ✅ **多图层支持**：透明混合、可见性控制、图层排序
- ✅ **智能文本渲染**：半角字符智能挤压（45%-55%），全角字符正常显示
- ✅ **选择工具**：框选、移动、缩放（最近邻插值）
- ✅ **撤销/重做**：支持 50 步历史记录
- ✅ **多格式导出**：C Array、Binary、PNG，支持水平/垂直扫描
- ✅ **实时预览**：导出前预览取模效果
- ✅ **项目管理**：保存/加载 .mpx 项目文件

---

## 安装与运行

### 系统要求

- **操作系统**：Windows 7/10/11、macOS 10.14+、Linux
- **Python 版本**：Python 3.10 或更高
- **内存**：至少 512MB RAM
- **磁盘空间**：至少 100MB

### 安装步骤

1. **克隆或下载项目**

```bash
git clone <repository-url>
cd 6_MonoPixel_Editor
```

2. **安装依赖**

```bash
pip install -r requirements.txt
```

依赖包括：
- PyQt6 >= 6.6.0
- numpy >= 1.24.0
- Pillow >= 10.0.0

3. **运行应用程序**

```bash
cd src
python main.py
```

### 使用打包版本

如果您下载的是打包后的可执行文件：

**Windows**：双击 `MonoPixelEditor.exe`

**macOS/Linux**：
```bash
chmod +x MonoPixelEditor
./MonoPixelEditor
```

---

## 界面介绍

### 主窗口布局

```
┌─────────────────────────────────────────────────────┐
│ 菜单栏：文件 | 编辑 | 视图                           │
├──────┬──────────────────────────────────┬───────────┤
│      │                                  │           │
│ 工具 │         画布区域                 │  属性面板 │
│ 栏   │    （缩放、平移、网格）           │           │
│      │                                  │  图层面板 │
│      │                                  │           │
├──────┴──────────────────────────────────┴───────────┤
│ 状态栏：工具信息 | 画布尺寸 | 缩放级别               │
└─────────────────────────────────────────────────────┘
```

### 界面组件说明

1. **菜单栏**
   - **文件**：新建、打开、保存、导出、退出
   - **编辑**：撤销、重做
   - **视图**：网格线、缩放控制

2. **工具栏**（左侧）
   - 画笔工具
   - 橡皮擦工具
   - 直线工具
   - 矩形工具
   - 圆形工具
   - 油漆桶填充
   - 选择工具
   - 文本工具

3. **画布区域**（中央）
   - 显示当前编辑的像素画
   - 支持滚轮缩放
   - 支持中键拖拽平移
   - 可选网格线显示

4. **属性面板**（右上）
   - 笔触大小（1-7px）
   - 填充模式（轮廓/填充/轮廓+填充）

5. **图层面板**（右下）
   - 图层列表
   - 新建/删除/复制图层
   - 上移/下移图层
   - 可见性/锁定控制

6. **状态栏**（底部）
   - 当前工具信息
   - 画布尺寸
   - 缩放级别

---

## 基础操作

### 创建新画布

1. 点击 **文件 → 新建** 或按 `Ctrl+N`
2. 输入画布宽度和高度（像素）
3. 点击 **确定**

**推荐尺寸**：
- OLED 128x64：128 x 64
- OLED 128x32：128 x 32
- LCD 212x104：212 x 104

### 画布导航

- **缩放**：
  - 滚轮向上：放大
  - 滚轮向下：缩小
  - `Ctrl++`：放大
  - `Ctrl+-`：缩小
  - `Ctrl+0`：重置缩放（100%）
  - `Ctrl+F`：适应窗口

- **平移**：
  - 按住中键拖拽
  - 或按住空格键 + 左键拖拽

- **网格线**：
  - 按 `G` 键切换网格线显示
  - 或点击 **视图 → 网格线**

### 撤销与重做

- **撤销**：`Ctrl+Z` 或 **编辑 → 撤销**
- **重做**：`Ctrl+Y` 或 **编辑 → 重做**
- 支持最多 50 步历史记录

---

## 工具详解

### 1. 画笔工具 (快捷键: 1)

**功能**：绘制自由线条

**使用方法**：
1. 选择画笔工具
2. 在属性面板设置笔触大小（1-7px）
3. 在画布上按住左键拖拽绘制

**技巧**：
- 小笔触（1-2px）适合细节绘制
- 大笔触（5-7px）适合快速填充

### 2. 橡皮擦工具 (快捷键: 2)

**功能**：擦除像素

**使用方法**：
1. 选择橡皮擦工具
2. 设置橡皮擦大小（1-7px）
3. 在画布上拖拽擦除

**技巧**：
- 使用小橡皮擦（1-2px）精确擦除
- 使用大橡皮擦（5-7px）快速清除区域

### 3. 直线工具 (快捷键: 3)

**功能**：绘制直线

**使用方法**：
1. 选择直线工具
2. 点击起点
3. 拖拽到终点
4. 释放鼠标完成绘制

**技巧**：
- 按住 `Shift` 键锁定角度（水平/垂直/45度）
- 使用 Bresenham 算法确保像素级精确

### 4. 矩形工具 (快捷键: 4)

**功能**：绘制矩形

**使用方法**：
1. 选择矩形工具
2. 在属性面板选择填充模式：
   - **轮廓**：只绘制边框
   - **填充**：只填充内部
   - **轮廓+填充**：边框和内部都绘制
3. 拖拽绘制矩形

**技巧**：
- 按住 `Shift` 键绘制正方形
- 轮廓模式适合绘制边框
- 填充模式适合快速填充区域

### 5. 圆形工具 (快捷键: 5)

**功能**：绘制圆形/椭圆

**使用方法**：
1. 选择圆形工具
2. 选择填充模式（同矩形工具）
3. 拖拽绘制圆形

**技巧**：
- 按住 `Shift` 键绘制正圆
- 使用 Bresenham 圆形算法确保平滑

### 6. 油漆桶填充 (快捷键: 6)

**功能**：填充连续区域

**使用方法**：
1. 选择油漆桶工具
2. 点击要填充的区域

**技巧**：
- 使用 4-连通泛洪算法
- 只填充相同颜色的连续区域
- 适合快速填充封闭区域

### 7. 选择工具 (快捷键: 7)

**功能**：选择、移动、缩放区域

**使用方法**：

**创建选区**：
1. 选择选择工具
2. 拖拽框选矩形区域

**移动选区**：
1. 点击选区内部
2. 拖拽到新位置

**缩放选区**：
1. 拖拽选区的 8 个手柄（角和边）
2. 使用最近邻插值保持像素清晰

**技巧**：
- 角手柄：同时调整宽度和高度
- 边手柄：只调整一个方向
- 移动和缩放操作支持撤销/重做

### 8. 文本工具 (快捷键: 8)

**功能**：添加文本

**使用方法**：
1. 选择文本工具
2. 点击画布位置
3. 在对话框中输入文本
4. 选择字体和大小
5. 点击确定

**技巧**：
- 支持系统字体和自定义字体（.ttf/.otf）
- 半角字符自动智能挤压（45%-55%）
- 全角字符（中文、日文等）正常显示
- 文本会自动二值化为黑白像素

---

## 图层管理

### 图层概念

图层是独立的绘图层，可以叠加显示。上层的黑色像素会遮挡下层，透明像素（白色）不遮挡。

### 图层操作

**新建图层**：
- 点击图层面板的 **新建** 按钮
- 新图层会添加到列表顶部

**删除图层**：
- 选择要删除的图层
- 点击 **删除** 按钮
- 注意：至少保留一个图层

**复制图层**：
- 选择要复制的图层
- 点击 **复制** 按钮
- 会创建一个完全相同的图层

**移动图层**：
- 点击 **上移** 按钮：图层向上移动一层
- 点击 **下移** 按钮：图层向下移动一层

**可见性控制**：
- 点击图层前的 **眼睛图标** 切换可见性
- 不可见的图层不会显示和导出

**锁定图层**：
- 点击 **锁图标** 锁定图层
- 锁定的图层无法编辑

**重命名图层**：
- 双击图层名称
- 输入新名称
- 按回车确认

### 图层混合规则

- 从下到上依次叠加
- 黑色像素（True）遮挡下层
- 白色像素（False）透明，不遮挡下层
- 只有可见图层参与混合

---

## 文本工具

### 文本渲染特性

MonoPixel Editor 的文本工具具有独特的智能渲染功能：

**半角字符智能挤压**：
- 英文字母、数字等半角字符会自动挤压到 45%-55% 宽度
- 动态调整，优先保证可读性
- 适合在有限空间内显示更多文本

**全角字符正常显示**：
- 中文、日文、韩文等全角字符保持正常宽度
- 不进行挤压，确保清晰度

### 使用步骤

1. **选择文本工具**（快捷键 `8`）

2. **点击画布位置**
   - 点击的位置是文本的左上角

3. **输入文本**
   - 在弹出的对话框中输入文本
   - 支持中英文混合

4. **选择字体**
   - 从下拉列表选择系统字体
   - 或点击 **加载字体** 加载自定义 .ttf/.otf 文件

5. **设置字体大小**
   - 输入字体大小（像素）
   - 推荐：12-24px

6. **预览和调整**
   - 文本会以浮动对象显示
   - 可以拖拽移动位置

7. **确认**
   - 点击确定或切换工具
   - 文本会栅格化到当前图层

### 技巧

- 使用等宽字体（如 Consolas、Courier New）获得更整齐的效果
- 字体大小建议不要太小（至少 10px），否则可能无法清晰显示
- 文本一旦栅格化就无法再编辑，建议在新图层上添加文本

---

## 选择工具

### 功能概述

选择工具允许您选择画布上的矩形区域，并对其进行移动和缩放操作。

### 创建选区

1. 选择选择工具（快捷键 `7`）
2. 在画布上拖拽框选矩形区域
3. 释放鼠标完成选区创建
4. 选区会显示蓝色虚线边框和 8 个手柄

### 移动选区

1. 将鼠标移到选区内部
2. 鼠标指针会变为移动光标
3. 按住左键拖拽到新位置
4. 释放鼠标完成移动
5. 原始位置会被清除（变为白色）

### 缩放选区

1. 将鼠标移到选区的手柄上
2. 手柄位置：
   - **角手柄**（4个）：西北、东北、西南、东南
   - **边手柄**（4个）：北、东、南、西
3. 按住左键拖拽手柄
4. 释放鼠标完成缩放

**缩放特性**：
- 使用最近邻插值算法
- 保持像素清晰，无模糊
- 支持任意比例缩放
- 放大和缩小都支持

### 清除选区

- 在选区外点击创建新选区
- 或切换到其他工具

### 技巧

- 移动和缩放操作都支持撤销/重做
- 缩放时建议使用整数倍比例（2x、3x）以获得最佳效果
- 选区操作会修改当前活动图层

---

## 导出功能

### 导出格式

MonoPixel Editor 支持三种导出格式：

1. **C Array**（.h 文件）
   - 适合嵌入式 C/C++ 项目
   - 生成 `const unsigned char` 数组
   - 包含宽度、高度和数据

2. **Binary**（.bin 文件）
   - 纯二进制数据
   - 适合直接写入 Flash
   - 文件最小

3. **PNG**（.png 文件）
   - 标准图像格式
   - 适合预览和分享
   - 保持 1-bit 颜色深度

### 导出选项

**扫描模式**：

1. **水平扫描**（Horizontal）
   - 逐行扫描，从左到右，从上到下
   - 适合大多数 LCD 显示器
   - 每行数据连续存储

2. **垂直扫描**（Vertical / Page Mode）
   - 逐列扫描，每 8 行为一页
   - 适合 OLED 显示器（如 SSD1306）
   - 每页数据连续存储

**位序**：

1. **MSB First**（最高位在前）
   - 每个字节的最高位对应第一个像素
   - 大多数显示器使用此格式

2. **LSB First**（最低位在前）
   - 每个字节的最低位对应第一个像素
   - 部分显示器使用此格式

**其他选项**：

- **反色**：黑白颜色互换
- **实时预览**：查看导出效果

### 导出步骤

1. **打开导出对话框**
   - 点击 **文件 → 导出** 或按 `Ctrl+E`

2. **选择导出格式**
   - C Array / Binary / PNG

3. **配置导出选项**
   - 扫描模式：水平/垂直
   - 位序：MSB First / LSB First
   - 反色：是/否

4. **预览**
   - 查看右侧预览区域
   - 确认导出效果正确

5. **选择保存位置**
   - 输入文件名
   - 选择保存路径

6. **导出**
   - 点击 **导出** 按钮
   - 等待导出完成

### C Array 格式示例

```c
// 宽度: 128, 高度: 64
const unsigned char image_data[] = {
    0xFF, 0x00, 0x81, 0x42, 0x24, 0x18, 0x00, 0xFF,
    0x00, 0xFF, 0x81, 0x42, 0x24, 0x18, 0x00, 0xFF,
    // ... 更多数据
};
```

### 在嵌入式项目中使用

**示例：在 Arduino 中显示图像**

```cpp
#include <Adafruit_SSD1306.h>

// 包含导出的头文件
#include "image_data.h"

Adafruit_SSD1306 display(128, 64);

void setup() {
    display.begin(SSD1306_SWITCHCAPVCC, 0x3C);
    display.clearDisplay();

    // 显示图像
    display.drawBitmap(0, 0, image_data, 128, 64, WHITE);
    display.display();
}
```

---

## 项目管理

### 项目文件格式

MonoPixel Editor 使用 `.mpx` 格式保存项目文件。

**文件内容**：
- 画布尺寸
- 所有图层数据（Base64 编码）
- 图层属性（名称、可见性、锁定状态）
- 图层顺序

### 保存项目

**首次保存**：
1. 点击 **文件 → 保存** 或按 `Ctrl+S`
2. 选择保存位置
3. 输入文件名（自动添加 .mpx 扩展名）
4. 点击 **保存**

**后续保存**：
- 按 `Ctrl+S` 快速保存到当前文件
- 或使用 **文件 → 另存为** 保存到新文件

### 打开项目

1. 点击 **文件 → 打开** 或按 `Ctrl+O`
2. 选择 .mpx 文件
3. 点击 **打开**
4. 如果当前项目未保存，会提示是否保存

### 新建项目

1. 点击 **文件 → 新建** 或按 `Ctrl+N`
2. 输入画布宽度和高度
3. 点击 **确定**
4. 如果当前项目未保存，会提示是否保存

### 未保存提示

- 项目修改后，标题栏会显示 `*` 标记
- 关闭窗口时会提示保存
- 打开新项目时会提示保存

---

## 快捷键参考

### 文件操作

| 快捷键 | 功能 |
|--------|------|
| `Ctrl+N` | 新建画布 |
| `Ctrl+O` | 打开项目 |
| `Ctrl+S` | 保存项目 |
| `Ctrl+Shift+S` | 另存为 |
| `Ctrl+E` | 导出 |
| `Ctrl+Q` | 退出 |

### 编辑操作

| 快捷键 | 功能 |
|--------|------|
| `Ctrl+Z` | 撤销 |
| `Ctrl+Y` | 重做 |

### 视图操作

| 快捷键 | 功能 |
|--------|------|
| `G` | 切换网格线 |
| `Ctrl+0` | 重置缩放（100%） |
| `Ctrl+F` | 适应窗口 |
| `Ctrl++` | 放大 |
| `Ctrl+-` | 缩小 |
| 滚轮 | 缩放 |
| 中键拖拽 | 平移画布 |

### 工具切换

| 快捷键 | 工具 |
|--------|------|
| `1` | 画笔工具 |
| `2` | 橡皮擦工具 |
| `3` | 直线工具 |
| `4` | 矩形工具 |
| `5` | 圆形工具 |
| `6` | 油漆桶填充 |
| `7` | 选择工具 |
| `8` | 文本工具 |

### 工具修饰键

| 修饰键 | 功能 |
|--------|------|
| `Shift + 拖拽` | 直线工具：锁定角度（水平/垂直/45度） |
| `Shift + 拖拽` | 矩形工具：锁定正方形 |
| `Shift + 拖拽` | 圆形工具：锁定正圆 |

---

## 常见问题

### Q1: 如何创建透明背景？

**A**: MonoPixel Editor 是单色编辑器，只有黑色和白色。白色像素在图层混合时表现为透明。如果需要透明背景，确保背景图层的像素为白色（False）。

### Q2: 导出的 C Array 如何在 Arduino 中使用？

**A**:
1. 将导出的 .h 文件复制到 Arduino 项目目录
2. 在代码中 `#include "your_file.h"`
3. 使用 `display.drawBitmap()` 函数显示

示例代码见 [导出功能](#在嵌入式项目中使用) 章节。

### Q3: 为什么文本显示不清晰？

**A**:
- 字体大小太小（建议至少 10px）
- 字体不适合像素化（建议使用等宽字体）
- 二值化阈值问题（自动处理，无需调整）

### Q4: 如何批量处理多个图像？

**A**: MonoPixel Editor 目前不支持批量处理。建议使用 Python 脚本调用核心模块进行批量处理。

### Q5: 支持哪些图像格式导入？

**A**: 目前不支持直接导入图像。建议：
1. 使用其他工具将图像转换为单色
2. 在 MonoPixel Editor 中手动绘制
3. 或使用 Python 脚本预处理

### Q6: 如何更改画布尺寸？

**A**: 目前不支持更改现有画布尺寸。建议：
1. 导出当前画布为 PNG
2. 新建所需尺寸的画布
3. 使用外部工具调整 PNG 尺寸后重新绘制

### Q7: 撤销/重做有限制吗？

**A**: 是的，最多支持 50 步历史记录。超过 50 步后，最早的记录会被删除。

### Q8: 如何选择正确的扫描模式？

**A**:
- **水平扫描**：大多数 LCD 显示器（如 Nokia 5110）
- **垂直扫描**：OLED 显示器（如 SSD1306、SSD1331）

查看您的显示器数据手册确认。

### Q9: MSB First 和 LSB First 有什么区别？

**A**:
- **MSB First**：每个字节的最高位（bit 7）对应第一个像素
- **LSB First**：每个字节的最低位（bit 0）对应第一个像素

大多数显示器使用 MSB First。如果显示效果不正确，尝试切换位序。

### Q10: 如何报告 Bug 或提出建议？

**A**:
- GitHub Issues: <repository-url>/issues
- 邮箱: <your-email>

---

## 技术支持

如有其他问题，请参考：
- [开发文档](DEVELOPMENT.md)
- [API 文档](API.md)
- [GitHub Issues](https://github.com/your-repo/issues)

---

**MonoPixel Editor v1.0**
© 2024 MonoPixel. All rights reserved.
License: MIT
