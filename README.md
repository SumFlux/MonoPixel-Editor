# MonoPixel Editor

一个基于 PyQt6 的单色像素画编辑与取模工具，专用于嵌入式 OLED/LCD 开发。

## 📚 文档

- **[用户手册](docs/USER_MANUAL.md)** - 完整的使用指南和功能说明
- **[开发文档](docs/DEVELOPMENT.md)** - 架构设计、开发指南和 API 文档
- **[打包发布指南](docs/BUILD_GUIDE.md)** - 多平台打包和发布流程

## 功能特性

- ✅ 1-bit 颜色深度（黑/白）
- ✅ 多图层支持（透明混合）
- ✅ 完整绘图工具箱（画笔、橡皮、几何图形、填充）
- ✅ 图层管理（新建、删除、复制、上移、下移）
- ✅ 撤销/重做系统（支持 50 步历史记录）
- ✅ 多种取模格式导出（水平/垂直扫描、MSB/LSB、字节对齐）
- ✅ 导出预览（反向解析验证）
- ✅ 多种导出格式（C Array、Binary、PNG）
- ✅ 选择工具（框选、移动、缩放）
- ✅ 特殊文本渲染（全角正常 + 半角智能挤压 45%-55%）

## 技术栈

- Python 3.10+
- PyQt6（GUI 框架）
- NumPy（位运算与数组处理）
- Pillow（图像处理辅助）

## 安装

```bash
# 安装依赖
pip install -r requirements.txt
```

## 运行

```bash
cd src
python main.py
```

## 打包

```bash
# Windows
build.bat

# 或手动打包
pyinstaller MonoPixelEditor.spec
```

打包后的可执行文件位于 `dist/MonoPixelEditor.exe`

## 测试

```bash
# 运行所有单元测试
python -m pytest tests/unit/ -v

# 运行测试覆盖率
python -m pytest tests/ --cov=src --cov-report=html
```

## 开发进度

### Phase 1: 项目初始化与基础框架 ✅
- [x] 创建项目目录结构
- [x] 实现 Canvas 和 Layer 数据模型
- [x] 实现 CanvasView（缩放、平移、网格线）
- [x] 实现 MainWindow 主窗口布局
- [x] 单元测试（12/12 通过）

### Phase 2: 基础绘图工具 ✅
- [x] BaseTool 抽象基类
- [x] 画笔工具（支持 1-7px 笔触）
- [x] 橡皮擦工具（支持 1-7px 大小）
- [x] 直线工具（支持 Shift 锁定角度）
- [x] 矩形工具（支持 Shift 锁定正方形，3种填充模式）
- [x] 圆形工具（支持 Shift 锁定正圆，3种填充模式）
- [x] 油漆桶填充（4-连通泛洪算法）
- [x] 工具栏和属性面板 UI
- [x] 实时预览功能
- [x] 单元测试（22/22 通过）

### Phase 3: 图层系统 ✅
- [x] 图层面板 UI（列表、新建、删除、复制、上移、下移）
- [x] 图层操作（可见性、锁定、重命名）
- [x] 撤销/重做栈（命令模式，支持 50 步历史）
- [x] 绘图命令集成（所有工具支持撤销/重做）
- [x] 图层命令（添加、删除、移动图层可撤销）
- [x] 单元测试（33/33 通过）

### Phase 4: 文本工具 ✅
- [x] 字体管理器（系统字体、等宽字体、自定义字体加载）
- [x] 文本渲染服务（QPainter 渲染）
- [x] 半角字符智能挤压（45%-55% 动态调整）
- [x] 全角字符判断（CJK、平假名、片假名等）
- [x] 文本工具（输入、字体选择、拖拽定位）
- [x] 二值化处理（阈值转换）
- [x] 文本栅格化到图层

### Phase 5: 选择工具与缩放 ✅
- [x] 选择工具（框选矩形区域）
- [x] 选区移动（拖拽移动）
- [x] 选区缩放（最近邻插值，8个手柄）
- [x] 选区边框和手柄显示
- [x] 撤销/重做支持

### Phase 6: 导出系统 ✅
- [x] 位运算工具（MSB/LSB 打包解包）
- [x] 水平扫描算法（逐行扫描）
- [x] 垂直扫描算法（Page mode，OLED 专用）
- [x] 导出为 C Array（.h 文件）
- [x] 导出为 Binary（.bin 文件）
- [x] 导出为 PNG（.png 文件）
- [x] 导出对话框 UI
- [x] 实时预览（反向解析验证）
- [x] 反色选项
- [x] 单元测试（56/56 通过）

### Phase 7: 项目保存/加载 ✅
- [x] 项目文件格式设计（JSON + Base64）
- [x] 保存项目（.mpx 文件）
- [x] 加载项目
- [x] 保存所有图层数据和设置
- [x] 修改标记（未保存提示）
- [x] 新建画布功能
- [x] 关闭时保存提示
- [x] 单元测试（65/65 通过）

### Phase 8: UI 优化与打包 ✅
- [x] 快捷键系统（文件、编辑、视图、工具切换）
- [x] UI 样式优化（深色主题 QSS）
- [x] PyInstaller 打包配置
- [x] 打包脚本（build.bat）

## 快捷键

### 文件操作
- `Ctrl+N`: 新建画布
- `Ctrl+S`: 保存项目
- `Ctrl+E`: 导出

### 编辑操作
- `Ctrl+Z`: 撤销
- `Ctrl+Y`: 重做

### 视图操作
- `G`: 切换网格线
- `Ctrl+0`: 重置缩放
- `Ctrl+F`: 适应窗口
- `Ctrl++`: 放大
- `Ctrl+-`: 缩小
- 滚轮: 缩放
- 中键拖拽: 平移画布

### 工具切换
- `1`: 画笔工具
- `2`: 橡皮擦工具
- `3`: 直线工具
- `4`: 矩形工具
- `5`: 圆形工具
- `6`: 油漆桶填充
- `7`: 选择工具
- `8`: 文本工具

### 工具修饰键
- `Shift + 拖拽`: 直线工具锁定角度（水平/垂直/45度）
- `Shift + 拖拽`: 矩形工具锁定正方形
- `Shift + 拖拽`: 圆形工具锁定正圆

## 许可证

MIT License
